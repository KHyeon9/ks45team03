<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ks45team03.rentravel.mapper.UserProfitMapper">

	<resultMap type="Profit" id="profitResultMap">
		<id property="profitCode" column="profit_code" />
		<result property="userId" column="user_id"/>
		<result property="paymentCode" column="payment_code"/>
		<result property="profitAmountSave" column="profit_amount_save"/>
		<result property="profitTotal" column="profit_total"/>
		<result property="profitSaveTime" column="profit_save_time"/>
		<result property="profitDayGroup" column="profit_day_group"/>	
	</resultMap>
	
	<resultMap type="ProfitDay" id="profitDayResultMap">
		<id property="profitDayCode" column="profit_day_code"/>
	  	<result property="userId" column="user_id"/>
	  	<result property="profitSaveYearMonth" column="profit_save_year_month"/>
	  	<result property="profitDayTotal" column="profit_day_total"/>
	  	<result property="profitDayGroup" column="profit_day_group"/>
	  	<result property="profitMonthGroup" column="profit_month_group"/>
	</resultMap>	
	
	
	
	<select id="getUserDayProfitList" resultMap="profitDayResultMap">
	/* 회원 일별 수익 목록 조회 */
		SELECT 
			pd.profit_day_code
			,pd.user_id
			,pd.profit_save_year_month
			,pd.profit_day_total
			,pd.profit_day_group
			,pd.profit_month_group
		FROM 
			tb_profit_day AS pd
		<where>
			pd.user_id = #{loginId}
			<if test="searchYear != null and searchYear != '' and searchDay != null and searchDay != ''">	
				and substring(${profitDayGroup},13,2) = substring(#{searchYear},3,2)				
			</if>
			<if test="searchYear != null and searchYear != '' and searchDay != null and searchDay != ''">
				and substring(${profitDayGroup},15,2) = #{searchMonth}
			</if>			
			<if test="searchYear != null and searchYear != '' and searchDay != null and searchDay != ''">
				and substring(${profitDayGroup},17,2) = #{searchDay}
			</if>
		</where> 
		<if test="startIndex != null and startIndex > -1">
			LIMIT #{startIndex}, #{pageSize}
		</if>
	
	</select>
	
	
	<select id="getUserProfitList" resultMap="profitResultMap">
	/* 회원 수익 목록 조회 */
		SELECT
			p.profit_code
			,p.user_id
			,p.payment_code
			,p.profit_amount_save
			,p.profit_total
			,p.profit_save_time	
			,p.profit_day_group
		FROM 
			tb_profit AS p
		WHERE 
			p.user_id = #{loginId}
		<if test="startIndex != null and startIndex > -1">
			LIMIT #{startIndex}, #{pageSize};
		</if>
	</select>
	
	
	<select id="dayProfitListCnt" parameterType="String" resultType="int">
	/* 일별 회원 수익 목록 행 갯수 */
		SELECT
			COUNT(1)
		FROM
			tb_profit_day AS pd
		WHERE
			pd.user_id = #{loginId};
	</select>
	
	
	<select id="profitListCnt" parameterType="String" resultType="int">
		/* 회원 수익 목록 행 갯수 */
		SELECT
			COUNT(1)
		FROM
			tb_profit AS p
		WHERE
			p.user_id = #{loginId};
	</select>
	
</mapper>	